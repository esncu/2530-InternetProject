<!DOCTYPE html>
<html>
    
    <head>
        <meta charset="UTF-8">
        <title>User Shop Page</title>
        <link rel="stylesheet" href="styles.css">
        <script src='session.js'></script>
        <script src="data.js"></script>
        <script src="togglesidebar.js"></script>
         
        <style>
            /*Overriding external css*/
            html,body, #content, .prod-display{
                overflow: auto !important;
            }
            body{
                display: block !important;
            }

            /*Main content (pushed under topbar)*/

            /*visible sidebar*/
            #main-content{
                margin-top: 70px !important; /* push below topbar */
                margin-left: 220px !important; /* space for sidebar */
                padding: 20px !important;
                transition: all 0.3s ease !important;

                display: block !important;
                overflow-y:auto !important;
                length: auto
            }
            /*hidden sidebar*/
            #main-content.full {
                margin-left: 20px !important;
            }

            /*category bar and product layout*/
            #main-content .container{
                display: flex !important;
                margin-top: 30px !important;
                height: auto;
            }

            /*product display zone*/
            #main-content .prod-display{
                height:100%;
                flex:1;
                padding: 10px !important;
                display: grid !important;
                grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)) !important;
                gap: 20px !important;

                width: 97%;
                max-height: calc(100vh - 70px); /* adjust based on topbar height */
                overflow-y: scroll !important;
            }
            #main-content .product{
                background-color:white !important;
                border: 1px solid gray !important;
                text-align: center;
                padding: 10px;
                border-radius: 5px;

                
                display: flex;
                flex-direction: column;
                justify-content: flex-start;
                width: 200px;
            }
            .product img{
                width: 100%;
                height: auto;
                background-color: white;
                margin-bottom: 10px;
                object-fit: contain;
            }
            .product .name{
                font-weight: bold;
                margin-bottom: 5px;
            }
            .product .price{
                color: red;
            }

            /*store info bar (above product and catbar)*/
            .store-info {
                position: sticky !important;
                top:0px !important;
                background-color: var(--sec-color) !important;
                padding: 15px 20px;
                border: 3px solid var(--prim-color) !important;
                border-radius: 10px !important;
                margin-bottom:30px !important;

                height: 100px;
                align-items: center;

                z-index:500 !important;
                display: flex;

            }
            .store-info h2{
                margin: 0px;
            }
            .store-info img{
                width: 80px;
                height: 80px;
                object-fit: contain;
                margin-right: 20px;
            }
            .store-info .actions{
                margin-top:10px !important;
            }
            .store-info button{
                margin-right: 10px !important;
                padding: 5px 10px !important;
                border: none;
                border-radius: 3px;
                cursor: pointer !important;

                display: inline-flex !important;
                justify-content: center !important;
                align-items: right !important;
                
            }
            .store-info .actions img{
                height: 25px !important;
                width: 25px !important;
                display: block !important;
            }
            .follow-btn, .chat-btn {
                background-color: white;
                color: black;
                border: 1px solid var(--fg-color);
                border-radius: 10px;

                display: inline-flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                overflow: visible !important;
            }
            .follow-btn:hover, .chat-btn:hover{
                transform: scale(1.08);
            }
            .store-details{
                display: flex;
                flex-direction: column;
                justify-content: center;
            }
            .store-details h2{
                margin: 0 0 10px;
            }
           

            /*product card*/
            .product-link{
                text-decoration: none;
                color: inherit;
                display: block;
            }
            .product-link .product{
                cursor: pointer;
                transition: transform 0.2s ease;
            }
            .product-link .product:hover{
                transform: scale(1.02);
            }
            

        </style>
    </head>

    <body>
        <!--sidebar-->
        <aside id='sidebar'>
            <a href="index.html">Home</a>
            <a href="panel.html">Profile</a>
            <a href="cart.html">Cart</a>
            <a href="about.html">About&nbsp;Us</a>
            <a href="contact.html">Contact&nbsp;Us</a>

        </aside>
        <!--topbar-->
        <header id='topbar'>
            <div id="topbar-logo">
                <button id="topbar-btn" onclick="toggleSidebar()">
                    <img src="./media/sidebar btn.png">
                </button>
                <a href="index.html"><img src="media/logo.webp" id='topbar-logo'></a>
            </div>
            
            <div id='topbar-nav'>
                <a href="cart.html"><img src="media/cart.png"></a>
                <a href="panel.html"><img src="media/user.png"></a>
            </div>
        </header>


        <div id="main-content">
            <!--store info bar-->
            <div class="store-info">
                <img id="store-image" alt="Store logo">

                <div class="store-details">
                    <h2 id="store-name"></h2>

                    <div class="actions">
                        <button class="follow-btn" onclick="clickFollow()">
                            <img src="media/follow icon2.png" alt="Follow">Follow
                        </button>
                        <button class="chat-btn" onclick="clickChat()">
                            <img src="media/chat icon.png" alt="Chat">Chat
                        </button>
                    </div>
                </div>
            </div>

                <!--Product display-->
            <div class="prod-display" id="prod-display"></div>
        </div>
    </body>

    <script>
        /*redirecting to the right site based on acc*/
        if(typeof sessionType != "undefined"){
            if(sessionType == "2"){
                window.location.href= "shop_admin.html";
            } else if (sessionType != "1"){
                window.location.href = "login.html";
            }
        }

        /*displaying the correct store page*/
        document.addEventListener("DOMContentLoaded", () => {
            window.onDataReady = () => {
                const storeName = localStorage.getItem("selectedStoreId");
                if (storeName == null){
                  console.log(storeName);
                  alert("No store selected");
                  return;
                }

                /* find store by id */
                const store = stores.find(s => s.name === storeName);
                console.log(store);
                if (!store) {
                  alert("Store not found!");
                  return;
                }

                /* display store info */
                document.getElementById("store-name").textContent = store.name;
                document.getElementById("store-image").src = store.image;

                /* render products */
                const container = document.getElementById("prod-display");
                container.innerHTML = "";
                store.Products.forEach(productData => {
                    let product = new Product(productData.name, productData.image, productData.price);
                    product.id = productData.id;
                    product.ratings = productData.ratings || [];
                    product.avgRating = productData.avgRating || 0;

                    /*create link wrapper*/
                    const cardLink = document.createElement("a");
                    cardLink.href = `product.html?id=${product.id}`; /*pass product id in the url*/
                    cardLink.className = "product-link";

                    /*build product card*/
                    const card = document.createElement("div");
                    card.className = "product";
                    card.innerHTML = `
                        <img src="${product.image}">
                        <div class="name">${product.name}</div>
                        <div class="price">RM ${product.price}</div>
                    `;

                    cardLink.appendChild(card);
                    container.appendChild(cardLink);
                });

            };

            initStores(); /*loads stores from IndexedDB*/
        });
        
  
        /*toggle sidebar*/


        function clickFollow(){
            alert("Followed!");
        }
        function clickChat(){
            alert("Seller is unavailable...");
        }
    </script>

</html>
